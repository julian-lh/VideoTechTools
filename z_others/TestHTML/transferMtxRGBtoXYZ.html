<!DOCTYPE html>
<html>
<head>
  <script language="JavaScript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.2.1/math.js"></script>
</head>
<body>
  <p id="result">loading result...</p>
  <p id="primes">loading result...</p>
  <script>

  function generateRGBToXYZMatrix(rx, ry, gx, gy, bx, by, wX, wY, wZ) {
  	// Anhlehnung an http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html
    const X = (x, y) => x/y;
    const Z = (x, y) => (1 - x - y)/y;

    const Xr = X(rx, ry);
    const Xg = X(gx, gy);
    const Xb = X(bx, by);
    const Yr = 1;
    const Yg = 1;
    const Yb = 1;
    const Zr = Z(rx, ry);
    const Zg = Z(gx, gy);
    const Zb = Z(bx, by);

    const wMtx = [wX, wY, wZ];
    const mtx1 = [[Xr, Xg, Xb],
    			  [1, 1, 1],
                  [Zr, Zg, Zb]];
	const invMtx1 = math.inv(mtx1);
    const s = math.multiply(invMtx1, wMtx);

    const transferMtx = [[s[0] * Xr, s[1] * Xg, s[2] * Xb],
    					 [s[0] * Yr, s[1] * Yg, s[2] * Yb],
                         [s[0] * Zr, s[1] * Zg, s[2] * Zb]];
    return transferMtx;
	};

  function XYZtoxyz(XYZ_array = [0, 0, 1]) {
    const x = XYZ_array[0] / (XYZ_array[0] + XYZ_array[1] + XYZ_array[2]);
    const y = XYZ_array[1] / (XYZ_array[0] + XYZ_array[1] + XYZ_array[2]);
    const z = XYZ_array[2] / (XYZ_array[0] + XYZ_array[1] + XYZ_array[2]);
    return [x, y, z];
	};

  //var mtxRGBToXYZ = generateRGBToXYZMatrix(0.64, 0.33, 0.29, 0.6, 0.15, 0.06, 0.95047, 1, 1.08883); // Rec.601(625)
  var mtxRGBToXYZ = generateRGBToXYZMatrix(0.64, 0.33, 0.3, 0.6, 0.15, 0.06, 0.95047, 1, 1.08883); // Rec.709
  //var mtxRGBToXYZ = generateRGBToXYZMatrix(0.708, 0.292, 0.170, 0.797, 0.131, 0.046, 0.95047, 1, 1.08883); // Rec.2020

  // Pr√ºfung, ob korrekte Werte wieder heraus kommen indem nacheinander
  // [1, 0, 0], [0, 1, 0], [0, 0, 1], [1, 1, 1] ausprobiert werden
  var primes = new Array(3);
  const XYZ = math.multiply(mtxRGBToXYZ, [0, 0, 1]);
  primes = XYZtoxyz(XYZ);


  document.getElementById("result").textContent = JSON.stringify(mtxRGBToXYZ);
  document.getElementById("primes").textContent = JSON.stringify(primes);
  </script>
</body>
</html>